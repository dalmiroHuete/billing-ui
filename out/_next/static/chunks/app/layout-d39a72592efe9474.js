(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{2262:(e,t,r)=>{Promise.resolve().then(r.bind(r,5502))},3113:(e,t,r)=>{"use strict";r.d(t,{c:()=>o});let o=(0,r(2115).createContext)(void 0)},5502:(e,t,r)=>{"use strict";r.d(t,{AppProviders:()=>P});var o=r(5155),a=r(2115),n=r(8865),i=r(1716),s=r(6715),c=r(192);let l=(0,r(3362).oY)({config:{initialColorMode:"light",useSystemColorMode:!1},colors:{brand:{primary:"#1a5f3c",secondary:"#2d7a4f",accent:"#4a9c6b",light:"#e8f5e8"},gray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"}},fonts:{heading:"Georgia, serif",body:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif'},components:{Button:{defaultProps:{colorScheme:"brand"},variants:{gradient:{bgGradient:"linear(to-r, brand.primary, brand.secondary)",color:"white",_hover:{bgGradient:"linear(to-r, brand.secondary, brand.accent)"}}}},Input:{defaultProps:{focusBorderColor:"brand.primary"},variants:{filled:{field:{bg:"white",border:"1px solid",borderColor:"brand.light",borderRadius:"lg",_focus:{borderColor:"brand.primary",boxShadow:"0 0 0 1px var(--chakra-colors-brand-primary)"}}}}}},styles:{global:{body:{bg:"white",color:"gray.800"}}}});var d=r(3113);let u=e=>{let{children:t}=e,[r,n]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=localStorage.getItem("auth_user");e&&n(JSON.parse(e))},[]),(0,o.jsx)(d.c.Provider,{value:{user:r,login:e=>{n(e.user),localStorage.setItem("auth_user",JSON.stringify(e.user)),localStorage.setItem("auth_token",e.access_token)},logout:()=>{n(null),localStorage.removeItem("auth_user"),localStorage.removeItem("auth_token")}},children:t})};var m=r(5695),y=r(9196),p=r(5041);let f=r(9509).env.NEXT_PUBLIC_API_URL||"http://localhost:8080";class h{static async setupOnboarding(e,t){let r=await fetch("".concat(f,"/onboarding"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});if(!r.ok){let e=await r.text();throw console.error("API Error:",e),Error("Failed to create company: ".concat(r.status," - ").concat(e))}let o=await r.json();return console.log("Company created successfully:",o),o}static async createPayment(e,t){let r=await fetch("".concat(f,"/payment"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});if(!r.ok)throw Error("Failed to create payment");return r.json()}static async confirmPayment(e,t){let r=await fetch("".concat(f,"/payment/").concat(e,"/confirm"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(!r.ok)throw Error("Failed to confirm payment");return r.json()}}let g=()=>{let e=()=>localStorage.getItem("auth_token"),t=(0,p.n)({mutationFn:t=>{let r=e();if(!r)throw Error("No authentication token found");return h.setupOnboarding(t,r)},onSuccess:e=>{console.log("Company created successfully:",e)},onError:e=>{console.error("Failed to create company:",e)}}),r=(0,p.n)({mutationFn:t=>{let r=e();if(!r)throw Error("No authentication token found");return h.createPayment(t,r)},onSuccess:e=>{console.log("Payment created successfully:",e)},onError:e=>{console.error("Failed to create payment:",e)}}),o=(0,p.n)({mutationFn:t=>{let r=e();if(!r)throw Error("No authentication token found");return h.confirmPayment(t,r)},onSuccess:e=>{console.log("Payment confirmed successfully:",e)},onError:e=>{console.error("Failed to confirm payment:",e)}});return{setupOnboarding:t.mutateAsync,createPayment:r.mutateAsync,confirmPayment:o.mutateAsync,isSettingUpOnboarding:t.isPending,isCreatingPayment:r.isPending,isConfirmingPayment:o.isPending,setupOnboardingError:t.error,createPaymentError:r.error,confirmPaymentError:o.error}},b=e=>{switch(e){case"PREPAID":return"BUY_CREDITS";case"SEATS":return"BUY_SEATS";default:return"MONTHLY_SUBSCRIPTION"}},S=e=>{let{children:t}=e,r=(0,m.useRouter)(),[n,i]=(0,a.useState)(1),[s,c]=(0,a.useState)(null),[l,d]=(0,a.useState)(null),[u,p]=(0,a.useState)(!1),[f,h]=(0,a.useState)(""),[S,P]=(0,a.useState)(""),{setupOnboarding:E,createPayment:w,confirmPayment:_}=g(),v=async()=>{if(s&&l){h("");try{let e={company:s,plan:{type:l.type,credits:l.credits,seats:l.seats}},t={companyId:(await E(e)).company.id.toString(),amount:l.price,reason:b(l.type)},o=await w(t);o&&o.id&&await _(o.id),P("Onboarding completed successfully! Redirecting..."),p(!1),setTimeout(()=>{r.push("/home")},2e3)}catch(e){console.error("Onboarding error:",e),e instanceof Error?h(e.message):h("Error completing onboarding. Please try again.")}}};return(0,o.jsx)(y.d.Provider,{value:{currentStep:n,companyData:s,selectedPlan:l,isPaymentDrawerOpen:u,formError:f,successMessage:S,setCurrentStep:i,setCompanyData:c,setSelectedPlan:d,setIsPaymentDrawerOpen:p,setFormError:h,setSuccessMessage:P,handleCompanySubmit:e=>{h(""),c({name:e.name,description:e.description}),i(2)},handlePlanSelect:e=>{d(e)},handlePlanSubmit:()=>{if(!l){h("Please select a plan");return}p(!0)},handlePaymentSubmit:v},children:t})};function P(e){let{children:t}=e,[r]=(0,a.useState)(()=>new i.E);return(0,o.jsx)(n.s,{theme:l,children:(0,o.jsxs)(s.Ht,{client:r,children:[(0,o.jsx)(u,{children:(0,o.jsx)(S,{children:t})}),(0,o.jsx)(c.E,{initialIsOpen:!1})]})})}},9196:(e,t,r)=>{"use strict";r.d(t,{d:()=>o});let o=(0,r(2115).createContext)(void 0)}},e=>{var t=t=>e(e.s=t);e.O(0,[677,41,815,332,441,684,358],()=>t(2262)),_N_E=e.O()}]);